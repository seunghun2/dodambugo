<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶€ê³  í…ŒìŠ¤íŠ¸ - ë„ë‹´ë¶€ê³ </title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: #FAFAFA;
            padding: 40px 20px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        
        h1 {
            font-size: 24px;
            font-weight: 700;
            color: #191F28;
            margin-bottom: 8px;
        }
        
        p {
            font-size: 15px;
            color: #4E5968;
            margin-bottom: 32px;
        }
        
        .bugo-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .bugo-card {
            padding: 20px;
            background: #F9FAFB;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .bugo-card:hover {
            background: #F2F4F6;
            border-color: #3182F6;
        }
        
        .bugo-card:active {
            transform: scale(0.98);
        }
        
        .bugo-name {
            font-size: 16px;
            font-weight: 600;
            color: #191F28;
            margin-bottom: 4px;
        }
        
        .bugo-id {
            font-size: 13px;
            color: #8B95A1;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #4E5968;
        }
        
        .error {
            text-align: center;
            padding: 40px;
            color: #E03131;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #E5E8EB;
            border-top-color: #3182F6;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 16px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .btn-back {
            display: inline-block;
            margin-bottom: 24px;
            padding: 10px 20px;
            background: #F2F4F6;
            border-radius: 8px;
            color: #4E5968;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-back:hover {
            background: #E5E8EB;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="btn-back">â† í™ˆìœ¼ë¡œ</a>
        <h1>ğŸ“‹ ìƒì„±ëœ ë¶€ê³ ì¥ ëª©ë¡</h1>
        <p>í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ìƒì„±ëœ ë¶€ê³ ì¥ì„ í™•ì¸í•˜ì„¸ìš”</p>
        
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>ë¶€ê³  ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
        
        <div id="error" class="error" style="display: none;">
            <p>ë¶€ê³  ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>
        </div>
        
        <div id="bugoList" class="bugo-list" style="display: none;">
            <!-- JavaScriptë¡œ ìƒì„±ë¨ -->
        </div>
    </div>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¶€ê³  ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        document.addEventListener('DOMContentLoaded', async function() {
            await loadBugoList();
        });

        async function loadBugoList() {
            try {
                console.log('ë¶€ê³  ëª©ë¡ API í˜¸ì¶œ ì‹œì‘...');
                const response = await fetch('tables/bugo?limit=50&sort=-created_at');
                console.log('API ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API ì˜¤ë¥˜ ì‘ë‹µ:', errorText);
                    throw new Error('API ì˜¤ë¥˜: ' + response.status);
                }
                
                const result = await response.json();
                console.log('ë¶€ê³  ëª©ë¡ ì‘ë‹µ:', result);
                console.log('ë°ì´í„° ê°œìˆ˜:', result.data ? result.data.length : 0);
                
                // ë¡œë”© ìˆ¨ê¸°ê¸°
                document.getElementById('loading').style.display = 'none';
                
                // ë°ì´í„°ê°€ ìˆìœ¼ë©´ í‘œì‹œ
                if (result.data && result.data.length > 0) {
                    displayBugoList(result.data);
                } else {
                    document.getElementById('error').style.display = 'block';
                    document.getElementById('error').innerHTML = '<p>ìƒì„±ëœ ë¶€ê³ ì¥ì´ ì—†ìŠµë‹ˆë‹¤.<br><a href="create.html" style="color: #3182F6;">ë¶€ê³ ì¥ ë§Œë“¤ê¸°</a></p>';
                }
                
            } catch (error) {
                console.error('ë¶€ê³  ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').innerHTML = `<p>ì˜¤ë¥˜: ${error.message}</p>`;
            }
        }

        function displayBugoList(bugoList) {
            const listContainer = document.getElementById('bugoList');
            listContainer.style.display = 'block';
            listContainer.innerHTML = '';
            
            bugoList.forEach(bugo => {
                const card = document.createElement('div');
                card.className = 'bugo-card';
                card.onclick = () => {
                    window.location.href = `view.html?id=${bugo.id}`;
                };
                
                // í…œí”Œë¦¿ ì´ë¦„ ë§¤í•‘
                const templateNames = {
                    'ribbon': 'ì •ì¤‘í˜• (ê²€ì€ë¦¬ë³¸)',
                    'basic': 'ê¸°ë³¸í˜• (ë‚˜ë­‡ê°€ì§€)',
                    'flower': 'ê³ ê¸‰í˜• (êµ­í™”)',
                    'border': 'ì•ˆë‚´í˜• (ëŒ€ë¦¬ì„)'
                };
                const templateName = templateNames[bugo.template] || 'ê¸°ë³¸í˜•';
                
                card.innerHTML = `
                    <div class="bugo-name">æ•… ${bugo.deceased_name || 'ì´ë¦„ ì—†ìŒ'} <span style="color: #3182F6; font-weight: 600;">[${templateName}]</span></div>
                    <div class="bugo-id">ID: ${bugo.id}</div>
                `;
                
                listContainer.appendChild(card);
            });
        }
    </script>
</body>
</html>
