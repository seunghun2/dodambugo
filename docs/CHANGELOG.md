# 마음부고 변경 이력

## 2026-01-28

### 제주 '일포' 기능 완성
- **View 페이지 일포 표시**: 일포일시를 발인보다 먼저, 진하게 표시
- **발인 조건부 표시**: 일포 ON일 때 발인 연하게 표시, hide_funeral 체크 시 숨김
- **DB 스키마 추가**: `ilpo_date`, `ilpo_time`, `hide_funeral`, `applicant_phone` 컬럼

### 수정하기 기능 개선
- **버튼 텍스트 변경**: 수정 모드에서 "부고장 만들기" → "수정하기"
- **신청자 연락처 로드/저장**: `applicant_phone` 필드 DB 저장 및 수정 시 로드
- **일포 OFF 시 데이터 초기화**: 일포 토글 OFF 시 날짜/시간 자동 삭제

### 성능 및 안정성 개선
- **Hydration 에러 해결**: `mounted` 상태 추가로 서버/클라이언트 렌더링 불일치 해결
- **Draft 로드 충돌 방지**: 수정 모드에서 임시저장 데이터 로드하지 않도록 수정

---

## 2026-01-18

### 화환 상품 지역별 가격 시스템 구현
- **시/도별 추가금**: 17개 지역(서울, 경기, 인천, 부산, 대구, 광주, 대전, 울산, 세종, 강원, 충북, 충남, 전북, 전남, 경북, 경남, 제주)별 가격 차등 설정
- **특수지역 추가금**: 산간/도서 지역(울릉군, 영월군 등) 추가금 태그 방식으로 설정
- 부고 주소 기반 자동 가격 계산 (기본가 + 시도 추가금 + 특수지역 추가금)
- 음수 값 지원 (지역별 할인 가능)

### 어드민 상품 관리 UI 개선
- **태그 기반 입력**: 노출지역, 제외지역, 제외장례식장 태그 방식 UI
- **미리보기 버튼**: 상품 상세페이지 새 탭 열기
- **Supabase Storage 이미지 업로드**: 상품 이미지 동적 업로드/삭제
- **시/도별 가격 그리드**: 17개 지역 추가금 입력 UI
- **특수지역 설정**: 지역명 + 추가금 입력 → 태그 표시

### 상품 정보 업데이트
- 기본 5개 상품 가격 정리: 소형 바구니(99,500), 기본형(109,500), 고급형(139,000), 프리미엄형(169,000), VIP용(189,000)
- 꽃 상품 DB 테이블 `regional_prices`, `special_surcharges` 컬럼 추가

### 지역 필터링 로직
- 부고 주소에서 시/도 자동 추출
- 상품별 노출/제외 지역 매칭
- 장례식장명 기반 제외 처리

---

## 2026-01-09

### 카카오 공유 링크 문제 해결
- **문제**: 카카오톡에서 공유된 링크 클릭 시 메인 페이지(`/`)로 리다이렉트 되는 현상 발생
- **원인 1**: 카카오 개발자 콘솔에서 도메인 설정 저장 누락 및 `https://maeumbugo.co.kr` (non-www) 불일치
- **원인 2**: `app/layout.tsx`에서 모든 페이지를 `MainLayout`으로 감싸고 있어, 독립적이어야 할 `view` 페이지와 레이아웃 간섭 발생
- **해결 1 (Fix)**: `app/create/complete/[bugoNumber]/page.tsx`에서 `bugoUrl` 생성 시 `https://maeumbugo.co.kr` 도메인 강제 적용
- **해결 2 (Refactor)**: `MainLayout`을 전역(`app/layout.tsx`)에서 제거하고, 검색/FAQ/가이드/Contact 등 필요한 페이지의 `layout.tsx`에만 개별 적용하여 `view` 페이지의 완전한 독립성 확보

### 2026-01-09 (오전)

### 장례가이드 페이지
- `/guide` 페이지 신규 생성
- 장례 절차, 비용, 예절, 장례식장 찾기 4가지 카드 UI
- 헤더 네비게이션에 "장례가이드" 메뉴 추가

### 공통 네비게이션 구조 개선
- `MainLayout` 컴포넌트로 헤더 통합 관리
- 홈, FAQ, Guide, Search, Create 페이지 공통 헤더 적용
- 중복 코드 제거 및 유지보수성 향상
- 모바일 `SideMenu`에 장례가이드 링크 추가

### UI 수정
- "자주묻는 질문" → "자주 묻는 질문" 띄어쓰기 수정

### 빌드 오류 수정
- `useSearchParams` Suspense boundary 오류 해결
- `useEffect` + `window.location` 방식으로 변경

### 서버 환경 복구
- npm ghosting (npm install 무한 대기) 해결
- ENOTEMPTY 오류 해결 (Finder 수동 삭제)
- Deep Purge 프로토콜 적용

---

## 2026-01-06

### 검색엔진 등록 (SEO)
- **네이버 서치어드바이저** 등록
  - HTML 메타태그 인증 완료
  - robots.txt 확인
  - 사이트맵 제출
- **구글 서치콘솔** 등록
  - DNS TXT 레코드 인증 완료
  - 사이트맵 제출

### 동적 사이트맵 구현
- `app/sitemap.ts` 동적 생성
- 정적 페이지 7개 포함
- 부고장 페이지 자동 포함 (현재 57개)
- Supabase에서 실시간 조회

### Google Analytics 4
- GA4 설정 (ID: G-6H5TT2F5RB)
- 이벤트 추적 구현:
  - `select_template`: 템플릿 선택
  - `complete_create`: 부고 생성 완료
  - `view`: 부고 조회
  - `share` (kakao/sms/link): 공유
  - `click_map`: 지도/내비
  - `copy_account`: 계좌 복사

### AI 검색 최적화 (LLM SEO)
- `llms.txt` 생성 (AI 크롤러용)
- `llms-full.txt` 상세 문서 생성
- `robots.txt` AI 봇 허용 규칙 추가
- Schema.org JSON-LD 메인 페이지에 추가

### 배포 자동화
- Vercel Production 브랜치: `main` → `nextjs`
- GitHub Default 브랜치: `main` → `nextjs`
- 이제 `git push`만으로 자동 Production 배포

### 개발/프로덕션 DB 분리
- **개발용 Supabase 프로젝트 생성** (maeumbugo-dev)
  - URL: `https://mnlyqhrjnpbkleenmszm.supabase.co`
  - Region: Seoul (ap-northeast-2)
- 테이블 스키마 복사 (bugo, drafts, facilities, guestbook, inquiries)
- 테스트 데이터 30개 생성
- `.env.local` 개발 DB 설정
  - 로컬: 개발 DB (maeumbugo-dev)
  - Production: 기존 DB (dodambugo)

### 버그 수정
- **상주 목록 중복 표시** 버그 수정
  - 대표상주가 mourners 배열에도 포함될 때 한 번만 표시되도록 수정

### 모바일 메인 UX 개선
- **플로팅 CTA 버튼** 추가 (모바일 전용)
  - 하단 고정 "부고장 만들기" 버튼
  - 하단에서 슬라이드업 애니메이션
  - 검은색 말풍선 툴팁: "링크형 부고장 무료 제작하기"
- **상단 nav-cta 숨김** (모바일에서 플로팅 버튼으로 대체)
- **검색바 입력 가능** (기존: 클릭 시 페이지 이동)
- **검색 자동완성** 기능
  - 실시간 DB 검색 (300ms 디바운스)
  - 상주 이름 매칭 우선 정렬
  - 검색어 하이라이트 (노란색)
  - 형식: `상주 김상민 (故 홍길동) | 발인 01/08`

---

## 2026-01-05

### 브랜드명 변경
- **도담부고 → 마음부고** 전체 변경
- 헤더, 푸터, 메타태그, OG 태그 등 50곳 이상 수정
- 문서 파일 (README, CHANGELOG, TODO 등) 전체 수정

### 도메인 & 카카오 설정
- 도메인 구매: maeumbugo.co.kr (가비아)
- Vercel 도메인 연결
- 카카오 새 앱 생성 (마음부고, ID: 1364022)
- 카카오 JS SDK 도메인 등록

---

## 2026-01-04

### UI/UX 개선

#### 모달 스타일 통일
- 모달 버튼 색상: 파란색 → 브랜드 컬러(#FFCC45)
- 모달 버튼 텍스트: 흰색 → 검은색(#191919)
- 임시저장 모달 문구: "임시저장된 정보" → "임시저장된 부고장"
- 개인정보 모달 "전문보기" 링크: 검은색(#191919)
- 개인정보 모달 "확인" 버튼 글씨: 검은색(#191919)

#### 모달 z-index 수정
- 모달 열렸을 때 헤더가 위에 보이는 문제 해결
- modal-overlay z-index: 99999 (인라인 스타일로 강제)
- 계좌 등록 모달, 상주별 계좌 모달, 임시저장 모달 모두 적용

#### 페이지 레이아웃 통일
- FAQ 페이지 헤더 스타일 통일 (section-header marginBottom: 16px)
- Contact 페이지 헤더 스타일 통일
- 개인정보처리방침 섹션 간격 줄임 (32px → 20px)

### 부고 검색 페이지 개선
- 제목/부제목 패딩 줄임
- 검색 버튼 아이콘만 표시 (텍스트 제거)
- 카드 레이아웃 변경:
  - 첫 줄: 부고번호 + 발인일
  - 둘째 줄: 상주 이름(故고인명)
  - 셋째 줄: 장례유형 | 장례식장
- 페이지네이션: 화살표 아이콘 + 브랜드 컬러(#FFCC45)

### OG 메타태그 개선
- 제목 형식: "故 OOO님 부고(향년 OO세)"
- 설명 형식: "장례식장 호실 | 날짜 별세하셨음을 삼가 알려드립니다."
- 이미지: 직사각형 og-bugo-v4.png

### 카카오 공유 이미지
- og-bugo-v4.png 적용 (캐시 문제 해결)

### 디자인 시스템
- 브랜드 컬러 #FFCC45 문서화

---

## 2026-01-03

### 부고 뷰 페이지
- 섹션 순서 변경
- 장례유형별 메시지 표시
- 발인 시간 포맷 개선

---

*이전 변경 내역은 Git 히스토리 참조*
